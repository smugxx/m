local Players = game:GetService("Players")
local BadgeService = game:GetService("BadgeService")
local InsertService = game:GetService("InsertService")
local Player = Players.LocalPlayer
local Events = InsertService.Events
local Spell = "aboleo"
local Processing = false
local Clashed = false

local Data = BadgeService:FindFirstChild("data")
if not Data then
	Data = Instance.new("Folder", BadgeService);
	Data.Name = "data";
end

local SpellHit = Data:FindFirstChild("spellHit")
if not SpellHit then
	SpellHit = Instance.new("IntValue", Data);
	SpellHit.Name = "SpellHit";
	SpellHit.Value = 1;
end

function PlrAdded(Target)
    Target.Chatted:Connect(function(Msg)
        if string.sub(Msg, 1, 3) ~= "/e " then
            local IsHacking = false
            task.wait(0.1);
            local Objects = Player.PlayerGui.Chat.Frame.ChatChannelParentFrame.Frame_MessageLogDisplay.Scroller:GetChildren()
            for _, Object in pairs(Objects) do
                if Object.Name == "Frame" then
                    if not string.find(Object.TextLabel.TextButton.Text, Target.DisplayName) or not string.find(Object.TextLabel.Text, Msg) then
                        if i == #Objects then
                            print(Target.Name .. " .. " .. Msg);
                        end
                    else
                        break;
                    end
                end
            end
        end
    end)
end

function EffectAdded(Object)
    if Object.Name == "spellProjectile" and not Clashed then
		local SpellID = tostring(Player.Name .. workspace.DistributedGameTime)
		local DistanceID = ((SpellHit.Value + 0.5428) * 2) ^ (math.pi * 0.5)
		Players:Chat(Spell);
		local DataTable = {
			hitPart = Object;
			actor = Object;
			hitCf = Object.CFrame;
			spellName = Spell;
			id = SpellID;
			distance = DistanceID;
		}
		Events.spellHit:FireServer(DataTable);
	end
end

function WorkspaceAdded(Object)
    task.wait(0.1);
    if Object.Name == "clashBlock" and Processing then
        Object:Destroy();
    end
end

function CharAdded(Character)
    local Humanoid = Character.Humanoid
    Humanoid.ChildAdded:Connect(function(Object)
        if Object.Name == "isClashing" then
            Clashed = true;
            Processing = true;
            local Wand = Character:FindFirstChild("Wand") or Character:FindFirstChild("Elder Wand")
            local Tip = Wand.Handle.Tip
            local TipClone = Tip:Clone()
            TipClone.Parent = Wand.Handle;
            Tip:Destroy();
            for _, Anim in pairs(Humanoid:GetPlayingAnimationTracks()) do
                if Anim.Name == "Animation" then
                    Anim:Stop();
                    Anim:Destroy();
                end
            end
            Object.Name = "randomname";
            task.wait(0.5);
            Processing = false;
        end
    end)
end

workspace.ChildAdded:Connect(WorkspaceAdded)
workspace.spellEffects.ChildAdded:Connect(EffectAdded)
Players.PlayerAdded:Connect(PlrAdded)

CharAdded(Player.Character)

for _, Target in pairs(Players:GetPlayers()) do
    PlrAdded(Target)
end
